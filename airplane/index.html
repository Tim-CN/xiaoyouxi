<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ‰“é£æœº - ZZXå°æ¸¸æˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Microsoft YaHei', sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            text-align: center;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        
        .logo {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .subtitle {
            font-size: 1rem;
            opacity: 0.9;
        }
        
        .container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        
        .game-container {
            background-color: white;
            border-radius: 8px;
            padding: 1.5rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            text-align: center;
            position: relative;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0.5rem 1rem;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            border-radius: 4px;
            color: white;
        }
        
        .score-container, .lives-container, .level-container {
            font-size: 1.2rem;
            font-weight: bold;
            display: flex;
            align-items: center;
        }
        
        .score-container::before {
            content: 'ğŸ†';
            margin-right: 0.5rem;
        }
        
        .lives-container::before {
            content: 'â¤ï¸';
            margin-right: 0.5rem;
        }
        
        .level-container::before {
            content: 'ğŸš©';
            margin-right: 0.5rem;
        }
        
        #game-canvas {
            border: 2px solid #6a11cb;
            border-radius: 4px;
            background-color: #000;
            display: block;
            margin: 0 auto;
        }
        
        .controls {
            margin-top: 1.5rem;
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.5rem 1.5rem;
            background: linear-gradient(to right, #6a11cb, #2575fc);
            color: white;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            cursor: pointer;
            transition: opacity 0.3s;
        }
        
        .btn:hover {
            opacity: 0.9;
        }
        
        .mobile-controls {
            display: none;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            margin-top: 1rem;
            max-width: 200px;
            margin-left: auto;
            margin-right: auto;
        }
        
        .mobile-btn {
            width: 60px;
            height: 60px;
            background: rgba(106, 17, 203, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
        }
        
        .mobile-btn:active {
            background: rgba(37, 117, 252, 0.9);
        }
        
        .shoot-btn {
            grid-column: 2;
            grid-row: 1;
            background: rgba(255, 0, 0, 0.7);
        }
        
        .left-btn {
            grid-column: 1;
            grid-row: 2;
        }
        
        .right-btn {
            grid-column: 3;
            grid-row: 2;
        }
        
        .game-over {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 2rem;
            border-radius: 8px;
            text-align: center;
            display: none;
            z-index: 10;
        }
        
        .game-over h2 {
            margin-bottom: 1rem;
            color: #ff4757;
        }
        
        .instructions {
            margin-top: 1.5rem;
            padding: 1rem;
            background-color: #f0f0f0;
            border-radius: 4px;
            text-align: left;
        }
        
        .instructions h3 {
            margin-bottom: 0.5rem;
            color: #6a11cb;
        }
        
        .instructions ul {
            list-style-position: inside;
            padding-left: 1rem;
        }
        
        .instructions li {
            margin-bottom: 0.5rem;
        }
        
        .key-bindings {
            display: grid;
            grid-template-columns: auto auto;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        .key {
            background: #ddd;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-weight: bold;
            text-align: center;
        }
        
        .back-btn {
            display: inline-block;
            margin-top: 1.5rem;
            padding: 0.5rem 1.5rem;
            background: #666;
            color: white;
            border-radius: 4px;
            text-decoration: none;
            font-weight: bold;
            transition: background 0.3s;
        }
        
        .back-btn:hover {
            background: #555;
        }
        
        footer {
            text-align: center;
            padding: 1.5rem;
            background-color: #333;
            color: #fff;
            margin-top: 2rem;
        }
        
        @media (max-width: 768px) {
            .logo {
                font-size: 1.5rem;
            }
            
            #game-canvas {
                width: 100%;
                height: auto;
            }
            
            .mobile-controls {
                display: grid;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">æ‰“é£æœºæ¸¸æˆ</div>
        <div class="subtitle">ZZXå°æ¸¸æˆåˆé›†</div>
    </header>
    
    <div class="container">
        <div class="game-container">
            <div class="game-header">
                <div class="score-container">åˆ†æ•°: <span id="score">0</span></div>
                <div class="lives-container">ç”Ÿå‘½: <span id="lives">3</span></div>
                <div class="level-container">å…³å¡: <span id="level">1</span></div>
            </div>
            
            <canvas id="game-canvas" width="600" height="700"></canvas>
            
            <div class="mobile-controls">
                <button class="mobile-btn shoot-btn">ğŸ”¥</button>
                <button class="mobile-btn left-btn">â†</button>
                <button class="mobile-btn right-btn">â†’</button>
            </div>
            
            <div class="game-over" id="game-over">
                <h2>æ¸¸æˆç»“æŸ</h2>
                <p>æœ€ç»ˆå¾—åˆ†: <span id="final-score">0</span></p>
                <button id="restart-btn" class="btn">å†ç©ä¸€æ¬¡</button>
            </div>
            
            <div class="controls">
                <button id="start-btn" class="btn">å¼€å§‹æ¸¸æˆ</button>
                <button id="pause-btn" class="btn" disabled>æš‚åœ</button>
            </div>
        </div>
        
        <div class="instructions">
            <h3>æ¸¸æˆè¯´æ˜:</h3>
            <ul>
                <li>ä½¿ç”¨æ–¹å‘é”®æˆ–A/Dé”®æ§åˆ¶é£æœºå·¦å³ç§»åŠ¨</li>
                <li>æŒ‰ç©ºæ ¼é”®æˆ–Jé”®å‘å°„å­å¼¹</li>
                <li>å‡»ä¸­æ•Œæœºè·å¾—åˆ†æ•°</li>
                <li>èº²é¿æ•ŒæœºåŠå…¶å­å¼¹ï¼Œå¦åˆ™ä¼šå¤±å»ç”Ÿå‘½</li>
                <li>æ¯å…³éš¾åº¦ä¼šå¢åŠ ï¼Œæ•Œæœºæ›´å¤šæ›´å¿«</li>
                <li>è·å¾—é«˜åˆ†è¿›å…¥æ’è¡Œæ¦œ!</li>
            </ul>
            
            <div class="key-bindings">
                <div class="key">â†/â†’</div>
                <div>å·¦å³ç§»åŠ¨</div>
                <div class="key">A/D</div>
                <div>å·¦å³ç§»åŠ¨</div>
                <div class="key">ç©ºæ ¼é”®</div>
                <div>å‘å°„å­å¼¹</div>
                <div class="key">Jé”®</div>
                <div>å‘å°„å­å¼¹</div>
                <div class="key">Pé”®</div>
                <div>æš‚åœ/ç»§ç»­</div>
            </div>
        </div>
        
        <a href="../" class="back-btn">è¿”å›æ¸¸æˆå¤§å…</a>
    </div>
    
    <footer>
        <p>Â© 2025 ZZXå°æ¸¸æˆ | ä½œè€…ï¼šZZX | æ‰€æœ‰æ¸¸æˆç‰ˆæƒå½’åŸä½œè€…æ‰€æœ‰</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const canvas = document.getElementById('game-canvas');
            const ctx = canvas.getContext('2d');
            const scoreElement = document.getElementById('score');
            const livesElement = document.getElementById('lives');
            const levelElement = document.getElementById('level');
            const finalScoreElement = document.getElementById('final-score');
            const gameOverElement = document.getElementById('game-over');
            const startBtn = document.getElementById('start-btn');
            const pauseBtn = document.getElementById('pause-btn');
            const restartBtn = document.getElementById('restart-btn');
            const shootBtn = document.querySelector('.shoot-btn');
            const leftBtn = document.querySelector('.left-btn');
            const rightBtn = document.querySelector('.right-btn');
            
            // æ¸¸æˆé…ç½®
            const PLAYER_SPEED = 5;
            const BULLET_SPEED = 7;
            const ENEMY_SPEED = 2;
            const ENEMY_BULLET_SPEED = 5;
            const POWER_UP_CHANCE = 0.01; // é“å…·å‡ºç°æ¦‚ç‡
            const ENEMY_SHOOT_CHANCE = 0.01; // æ•Œæœºå°„å‡»æ¦‚ç‡
            
            // æ¸¸æˆçŠ¶æ€
            let player = {
                x: canvas.width / 2,
                y: canvas.height - 50,
                width: 50,
                height: 60,
                speed: PLAYER_SPEED,
                lives: 3,
                isInvulnerable: false,
                invulnerabilityTimer: 0
            };
            
            let bullets = [];
            let enemies = [];
            let enemyBullets = [];
            let powerUps = [];
            let score = 0;
            let level = 1;
            let gameRunning = false;
            let gameOver = false;
            let animationFrameId = null;
            let lastTime = 0;
            let enemySpawnRate = 60; // æ•Œæœºç”Ÿæˆé¢‘ç‡ï¼ˆå¸§æ•°ï¼‰
            let enemySpawnCounter = 0;
            
            // åˆå§‹åŒ–æ¸¸æˆ
            function initGame() {
                // é‡ç½®æ¸¸æˆçŠ¶æ€
                player = {
                    x: canvas.width / 2,
                    y: canvas.height - 50,
                    width: 50,
                    height: 60,
                    speed: PLAYER_SPEED,
                    lives: 3,
                    isInvulnerable: false,
                    invulnerabilityTimer: 0
                };
                
                bullets = [];
                enemies = [];
                enemyBullets = [];
                powerUps = [];
                score = 0;
                level = 1;
                gameOver = false;
                enemySpawnRate = 60;
                enemySpawnCounter = 0;
                
                // æ›´æ–°æ˜¾ç¤º
                scoreElement.textContent = score;
                livesElement.textContent = player.lives;
                levelElement.textContent = level;
                
                // éšè—æ¸¸æˆç»“æŸç•Œé¢
                gameOverElement.style.display = 'none';
                
                // ç»˜åˆ¶åˆå§‹çŠ¶æ€
                draw();
                
                // å¯ç”¨å¼€å§‹æŒ‰é’®
                startBtn.disabled = false;
                pauseBtn.disabled = true;
            }
            
            // ç»˜åˆ¶æ¸¸æˆ
            function draw() {
                // æ¸…ç©ºç”»å¸ƒ
                ctx.fillStyle = '#000';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
                drawStars();
                
                // ç»˜åˆ¶ç©å®¶é£æœº
                drawPlayer();
                
                // ç»˜åˆ¶å­å¼¹
                drawBullets();
                
                // ç»˜åˆ¶æ•Œæœº
                drawEnemies();
                
                // ç»˜åˆ¶æ•Œæœºå­å¼¹
                drawEnemyBullets();
                
                // ç»˜åˆ¶é“å…·
                drawPowerUps();
            }
            
            // ç»˜åˆ¶æ˜Ÿç©ºèƒŒæ™¯
            function drawStars() {
                ctx.fillStyle = '#FFF';
                for (let i = 0; i < 100; i++) {
                    const x = Math.sin(i * 123.45) * canvas.width / 2 + canvas.width / 2;
                    const y = Math.cos(i * 67.89) * canvas.height / 2 + canvas.height / 2;
                    const size = Math.random() * 2;
                    ctx.fillRect(x, y, size, size);
                }
            }
            
            // ç»˜åˆ¶ç©å®¶é£æœº
            function drawPlayer() {
                // ç»˜åˆ¶é£æœºä¸»ä½“
                ctx.fillStyle = player.isInvulnerable ? 'rgba(0, 255, 255, 0.5)' : '#3498db';
                
                // é£æœºå½¢çŠ¶
                ctx.beginPath();
                ctx.moveTo(player.x, player.y);
                ctx.lineTo(player.x - player.width / 2, player.y + player.height);
                ctx.lineTo(player.x + player.width / 2, player.y + player.height);
                ctx.closePath();
                ctx.fill();
                
                // é£æœºæœºç¿¼
                ctx.fillStyle = '#2980b9';
                ctx.fillRect(player.x - player.width / 2 - 10, player.y + player.height / 2, 10, 5);
                ctx.fillRect(player.x + player.width / 2, player.y + player.height / 2, 10, 5);
                
                // é£æœºå¼•æ“å…‰æ•ˆ
                ctx.fillStyle = '#ff9500';
                ctx.beginPath();
                ctx.arc(player.x, player.y + player.height + 5, 5, 0, Math.PI);
                ctx.fill();
            }
            
            // ç»˜åˆ¶å­å¼¹
            function drawBullets() {
                ctx.fillStyle = '#ff9500';
                for (const bullet of bullets) {
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y, 3, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å­å¼¹å°¾è¿¹
                    ctx.fillStyle = 'rgba(255, 149, 0, 0.5)';
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y + 5, 2, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#ff9500';
                }
            }
            
            // ç»˜åˆ¶æ•Œæœº
            function drawEnemies() {
                for (const enemy of enemies) {
                    ctx.fillStyle = enemy.type === 'boss' ? '#e74c3c' : '#e67e22';
                    
                    // æ•Œæœºå½¢çŠ¶
                    ctx.beginPath();
                    ctx.moveTo(enemy.x, enemy.y);
                    ctx.lineTo(enemy.x - enemy.width / 2, enemy.y + enemy.height);
                    ctx.lineTo(enemy.x + enemy.width / 2, enemy.y + enemy.height);
                    ctx.closePath();
                    ctx.fill();
                    
                    // æ•Œæœºæœºç¿¼
                    ctx.fillStyle = enemy.type === 'boss' ? '#c0392b' : '#d35400';
                    ctx.fillRect(enemy.x - enemy.width / 2 - 8, enemy.y + enemy.height / 2, 8, 4);
                    ctx.fillRect(enemy.x + enemy.width / 2, enemy.y + enemy.height / 2, 8, 4);
                    
                    // ç»˜åˆ¶bossè¡€æ¡
                    if (enemy.type === 'boss') {
                        ctx.fillStyle = '#555';
                        ctx.fillRect(enemy.x - 25, enemy.y - 10, 50, 5);
                        ctx.fillStyle = '#2ecc71';
                        ctx.fillRect(enemy.x - 25, enemy.y - 10, 50 * (enemy.health / enemy.maxHealth), 5);
                    }
                }
            }
            
            // ç»˜åˆ¶æ•Œæœºå­å¼¹
            function drawEnemyBullets() {
                ctx.fillStyle = '#ff4757';
                for (const bullet of enemyBullets) {
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y, 4, 0, Math.PI * 2);
                    ctx.fill();
                    
                    // å­å¼¹å°¾è¿¹
                    ctx.fillStyle = 'rgba(255, 71, 87, 0.5)';
                    ctx.beginPath();
                    ctx.arc(bullet.x, bullet.y - 5, 3, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.fillStyle = '#ff4757';
                }
            }
            
            // ç»˜åˆ¶é“å…·
            function drawPowerUps() {
                for (const powerUp of powerUps) {
                    if (powerUp.type === 'life') {
                        // ç”Ÿå‘½é“å…·
                        ctx.fillStyle = '#ff4757';
                        ctx.beginPath();
                        ctx.moveTo(powerUp.x, powerUp.y - 10);
                        ctx.lineTo(powerUp.x - 10, powerUp.y + 10);
                        ctx.lineTo(powerUp.x + 10, powerUp.y + 10);
                        ctx.closePath();
                        ctx.fill();
                    } else if (powerUp.type === 'power') {
                        // ç«åŠ›å¢å¼ºé“å…·
                        ctx.fillStyle = '#3498db';
                        ctx.beginPath();
                        ctx.arc(powerUp.x, powerUp.y, 8, 0, Math.PI * 2);
                        ctx.fill();
                        ctx.fillStyle = '#ff9500';
                        ctx.fillRect(powerUp.x - 2, powerUp.y - 10, 4, 20);
                        ctx.fillRect(powerUp.x - 10, powerUp.y - 2, 20, 4);
                    }
                }
            }
            
            // æ›´æ–°æ¸¸æˆçŠ¶æ€
            function update(timestamp) {
                if (!gameRunning || gameOver) return;
                
                const deltaTime = timestamp - lastTime;
                lastTime = timestamp;
                
                // ç§»åŠ¨ç©å®¶
                updatePlayer();
                
                // ç§»åŠ¨å­å¼¹
                updateBullets();
                
                // ç§»åŠ¨æ•Œæœº
                updateEnemies();
                
                // ç§»åŠ¨æ•Œæœºå­å¼¹
                updateEnemyBullets();
                
                // ç§»åŠ¨é“å…·
                updatePowerUps();
                
                // ç”Ÿæˆæ•Œæœº
                spawnEnemies();
                
                // æ£€æµ‹ç¢°æ’
                checkCollisions();
                
                // æ›´æ–°æ— æ•ŒçŠ¶æ€
                if (player.isInvulnerable) {
                    player.invulnerabilityTimer--;
                    if (player.invulnerabilityTimer <= 0) {
                        player.isInvulnerable = false;
                    }
                }
                
                // ç»˜åˆ¶æ¸¸æˆ
                draw();
                
                // ç»§ç»­æ¸¸æˆå¾ªç¯
                if (gameRunning && !gameOver) {
                    animationFrameId = requestAnimationFrame(update);
                } else if (gameOver) {
                    showGameOver();
                }
            }
            
            // æ›´æ–°ç©å®¶ä½ç½®
            function updatePlayer() {
                // ç©å®¶ç§»åŠ¨ç”±é”®ç›˜äº‹ä»¶å¤„ç†
            }
            
            // æ›´æ–°å­å¼¹ä½ç½®
            function updateBullets() {
                for (let i = bullets.length - 1; i >= 0; i--) {
                    bullets[i].y -= BULLET_SPEED;
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„å­å¼¹
                    if (bullets[i].y < 0) {
                        bullets.splice(i, 1);
                    }
                }
            }
            
            // æ›´æ–°æ•Œæœºä½ç½®
            function updateEnemies() {
                for (let i = enemies.length - 1; i >= 0; i--) {
                    enemies[i].y += enemies[i].speed;
                    
                    // æ•Œæœºå°„å‡»
                    if (Math.random() < ENEMY_SHOOT_CHANCE) {
                        enemyShoot(enemies[i]);
                    }
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„æ•Œæœº
                    if (enemies[i].y > canvas.height) {
                        enemies.splice(i, 1);
                    }
                }
            }
            
            // æ›´æ–°æ•Œæœºå­å¼¹ä½ç½®
            function updateEnemyBullets() {
                for (let i = enemyBullets.length - 1; i >= 0; i--) {
                    enemyBullets[i].y += ENEMY_BULLET_SPEED;
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„å­å¼¹
                    if (enemyBullets[i].y > canvas.height) {
                        enemyBullets.splice(i, 1);
                    }
                }
            }
            
            // æ›´æ–°é“å…·ä½ç½®
            function updatePowerUps() {
                for (let i = powerUps.length - 1; i >= 0; i--) {
                    powerUps[i].y += 2;
                    
                    // ç§»é™¤è¶…å‡ºå±å¹•çš„é“å…·
                    if (powerUps[i].y > canvas.height) {
                        powerUps.splice(i, 1);
                    }
                }
            }
            
            // ç”Ÿæˆæ•Œæœº
            function spawnEnemies() {
                enemySpawnCounter++;
                
                if (enemySpawnCounter >= enemySpawnRate) {
                    enemySpawnCounter = 0;
                    
                    const type = Math.random() < 0.1 ? 'boss' : 'normal';
                    const width = type === 'boss' ? 70 : 40;
                    const height = type === 'boss' ? 50 : 40;
                    const speed = type === 'boss' ? ENEMY_SPEED * 0.7 : ENEMY_SPEED + level * 0.2;
                    
                    enemies.push({
                        x: Math.random() * (canvas.width - width) + width / 2,
                        y: -height,
                        width: width,
                        height: height,
                        speed: speed,
                        type: type,
                        health: type === 'boss' ? 5 : 1,
                        maxHealth: type === 'boss' ? 5 : 1
                    });
                    
                    // éšç€å…³å¡å¢åŠ ï¼Œæ•Œæœºç”Ÿæˆé¢‘ç‡æé«˜
                    enemySpawnRate = Math.max(20, 60 - level * 5);
                }
                
                // éšæœºç”Ÿæˆé“å…·
                if (Math.random() < POWER_UP_CHANCE) {
                    const type = Math.random() < 0.5 ? 'life' : 'power';
                    powerUps.push({
                        x: Math.random() * (canvas.width - 20) + 10,
                        y: -20,
                        type: type
                    });
                }
            }
            
            // æ•Œæœºå°„å‡»
            function enemyShoot(enemy) {
                enemyBullets.push({
                    x: enemy.x,
                    y: enemy.y + enemy.height,
                    width: 8,
                    height: 16
                });
            }
            
            // æ£€æµ‹ç¢°æ’
            function checkCollisions() {
                // æ£€æµ‹å­å¼¹å’Œæ•Œæœºçš„ç¢°æ’
                for (let i = bullets.length - 1; i >= 0; i--) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        if (checkCollision(bullets[i], enemies[j])) {
                            // ç§»é™¤å­å¼¹
                            bullets.splice(i, 1);
                            
                            // å‡å°‘æ•Œæœºç”Ÿå‘½å€¼
                            enemies[j].health--;
                            
                            // å¦‚æœæ•Œæœºç”Ÿå‘½å€¼ä¸º0ï¼Œç§»é™¤æ•Œæœºå¹¶å¢åŠ åˆ†æ•°
                            if (enemies[j].health <= 0) {
                                const points = enemies[j].type === 'boss' ? 500 : 100;
                                score += points;
                                scoreElement.textContent = score;
                                enemies.splice(j, 1);
                                
                                // æ¯2000åˆ†å‡ä¸€çº§
                                if (score % 2000 < points && score >= 2000) {
                                    levelUp();
                                }
                            }
                            break;
                        }
                    }
                }
                
                // æ£€æµ‹ç©å®¶å’Œæ•Œæœºçš„ç¢°æ’
                for (let i = enemies.length - 1; i >= 0; i--) {
                    if (!player.isInvulnerable && checkCollision(player, enemies[i])) {
                        playerLoseLife();
                        enemies.splice(i, 1);
                        break;
                    }
                }
                
                // æ£€æµ‹ç©å®¶å’Œæ•Œæœºå­å¼¹çš„ç¢°æ’
                for (let i = enemyBullets.length - 1; i >= 0; i--) {
                    if (!player.isInvulnerable && checkCollision(player, enemyBullets[i])) {
                        playerLoseLife();
                        enemyBullets.splice(i, 1);
                        break;
                    }
                }
                
                // æ£€æµ‹ç©å®¶å’Œé“å…·çš„ç¢°æ’
                for (let i = powerUps.length - 1; i >= 0; i--) {
                    if (checkCollision(player, powerUps[i])) {
                        if (powerUps[i].type === 'life') {
                            // å¢åŠ ç”Ÿå‘½
                            player.lives = Math.min(player.lives + 1, 5);
                            livesElement.textContent = player.lives;
                        } else if (powerUps[i].type === 'power') {
                            // å¢å¼ºç«åŠ›ï¼ˆæš‚æ—¶å®ç°ä¸ºä¸‰è¿å‘ï¼‰
                            for (let i = 0; i < 3; i++) {
                                setTimeout(() => {
                                    shoot();
                                }, i * 100);
                            }
                        }
                        powerUps.splice(i, 1);
                    }
                }
            }
            
            // æ£€æµ‹ä¸¤ä¸ªå¯¹è±¡æ˜¯å¦ç¢°æ’
            function checkCollision(obj1, obj2) {
                return obj1.x < obj2.x + obj2.width &&
                       obj1.x + obj1.width > obj2.x &&
                       obj1.y < obj2.y + obj2.height &&
                       obj1.y + obj1.height > obj2.y;
            }
            
            // ç©å®¶å¤±å»ç”Ÿå‘½
            function playerLoseLife() {
                player.lives--;
                livesElement.textContent = player.lives;
                
                // è®¾ç½®æ— æ•ŒçŠ¶æ€
                player.isInvulnerable = true;
                player.invulnerabilityTimer = 120; // 2ç§’æ— æ•Œæ—¶é—´
                
                if (player.lives <= 0) {
                    gameOver = true;
                }
            }
            
            // å‡çº§
            function levelUp() {
                level++;
                levelElement.textContent = level;
            }
            
            // æ˜¾ç¤ºæ¸¸æˆç»“æŸç•Œé¢
            function showGameOver() {
                finalScoreElement.textContent = score;
                gameOverElement.style.display = 'block';
            }
            
            // å‘å°„å­å¼¹
            function shoot() {
                bullets.push({
                    x: player.x,
                    y: player.y,
                    width: 6,
                    height: 12
                });
            }
            
            // å¼€å§‹æ¸¸æˆ
            function startGame() {
                if (!gameRunning && !gameOver) {
                    gameRunning = true;
                    startBtn.disabled = true;
                    pauseBtn.disabled = false;
                    lastTime = performance.now();
                    animationFrameId = requestAnimationFrame(update);
                }
            }
            
            // æš‚åœæ¸¸æˆ
            function pauseGame() {
                if (gameRunning) {
                    gameRunning = false;
                    cancelAnimationFrame(animationFrameId);
                    pauseBtn.textContent = "ç»§ç»­";
                } else {
                    gameRunning = true;
                    pauseBtn.textContent = "æš‚åœ";
                    lastTime = performance.now();
                    animationFrameId = requestAnimationFrame(update);
                }
            }
            
            // ç§»åŠ¨ç©å®¶
            function movePlayer(direction) {
                if (!gameRunning || gameOver) return;
                
                if (direction === 'left') {
                    player.x = Math.max(player.width / 2, player.x - player.speed);
                } else if (direction === 'right') {
                    player.x = Math.min(canvas.width - player.width / 2, player.x + player.speed);
                }
            }
            
            // é”®ç›˜æ§åˆ¶
            document.addEventListener('keydown', (e) => {
                if (!gameRunning && e.keyCode !== 32) return;
                
                switch(e.keyCode) {
                    case 37: // Left arrow
                    case 65: // A
                        movePlayer('left');
                        break;
                    case 39: // Right arrow
                    case 68: // D
                        movePlayer('right');
                        break;
                    case 32: // Space
                    case 74: // J
                        if (gameRunning) {
                            shoot();
                        } else if (!gameOver) {
                            startGame();
                        }
                        break;
                    case 80: // P key
                        if (gameRunning || pauseBtn.textContent === "ç»§ç»­") {
                            pauseGame();
                        }
                        break;
                }
            });
            
            // ç§»åŠ¨ç«¯æ§åˆ¶
            shootBtn.addEventListener('click', () => {
                if (gameRunning) shoot();
            });
            
            leftBtn.addEventListener('touchstart', () => {
                moveLeftInterval = setInterval(() => movePlayer('left'), 16);
            });
            
            leftBtn.addEventListener('touchend', () => {
                clearInterval(moveLeftInterval);
            });
            
            rightBtn.addEventListener('touchstart', () => {
                moveRightInterval = setInterval(() => movePlayer('right'), 16);
            });
            
            rightBtn.addEventListener('touchend', () => {
                clearInterval(moveRightInterval);
            });
            
            // æŒ‰é’®äº‹ä»¶ç›‘å¬
            startBtn.addEventListener('click', startGame);
            pauseBtn.addEventListener('click', pauseGame);
            restartBtn.addEventListener('click', initGame);
            
            // åˆå§‹ç»˜åˆ¶
            initGame();
            
            // é˜²æ­¢ç§»åŠ¨ç«¯é¡µé¢æ»šåŠ¨
            document.body.addEventListener('touchmove', (e) => {
                if (e.target === canvas) {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>
